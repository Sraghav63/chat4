# Nixpacks configuration for Coolify deployment
# This file configures the build environment for deploying to platforms like Coolify

[phases.setup]
# Include Node.js, Python, and build tools for native module compilation
# nodejs_22 provides npm and node runtime
# python3, gcc, gnumake are required by bufferutil and other native modules
nixPkgs = ["nodejs_22", "python3", "gcc", "gnumake"]

[phases.install]
# Use pnpm with frozen lockfile for reproducible builds
cmds = ["npm install -g corepack@0.24.1", "corepack enable", "pnpm install --frozen-lockfile"]

[phases.build]
cmds = ["pnpm run build"]

[start]
cmd = "pnpm run start"
